# 5) Run Mend scans + export SCA report
- name: Run Mend Scans and Generate Report
  env:
    MEND_USER_KEY: ${{ secrets.MEND_USER_KEY }}
    MEND_EMAIL: ${{ vars.ENVEMAIL }}
    MEND_URL: https://saas-eu.mend.io
  run: |
    # Application / Project in Mend
    MEND_SCOPE="pipeline//Github Webgoat"

    echo "--- Running Mend SCA with Reachability ---"
    ./mend dep \
      --dir "$GITHUB_WORKSPACE" \
      --scope "$MEND_SCOPE" \
      --reachability \
      --update

    echo "--- Running Mend SAST ---"
    ./mend code \
      --dir "$GITHUB_WORKSPACE" \
      --scope "$MEND_SCOPE" \
      --update

    echo "--- Running Mend Container Image scan ---"
    ./mend image wstabac/cndemo \
      --scope "$MEND_SCOPE" \
      --update

    echo "--- Waiting 30 seconds for server processing ---"
    sleep 30

    echo "--- Exporting SCA JSON report ---"
    ./mend dep \
      --dir "$GITHUB_WORKSPACE" \
      --scope "$MEND_SCOPE" \
      --export-results sca-report.json
